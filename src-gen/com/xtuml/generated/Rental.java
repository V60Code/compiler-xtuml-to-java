package com.xtuml.generated;

import com.xtuml.runtime.BaseModel;
import com.xtuml.runtime.ObjectBroker;
import com.xtuml.runtime.RelationshipManager;
import com.xtuml.runtime.XtUmlEvent;
import java.util.UUID;
import java.time.LocalDateTime;

// Generated by xtUML Compiler
// Class ID: 4
public class Rental extends BaseModel {

    // Event Constants
    public static final int EVENT_END_TIME_PASSED = 2258;
    public static final int EVENT_SETCANCELED = 6587;
    public static final int EVENT_PAY_CONFIRMED = 7832;
    public static final int EVENT_SETEXPIRED = 179;
    public static final int EVENT_SETCOMPLETED = 6201;
    public static final int EVENT_CANCEL_REQUEST = 3882;
    public static final int EVENT_UNIT_RETURNED = 2266;

    // State Enum
    public enum State {
        PENDING,
        RENTED,
        EXPIRED,
        COMPLETED,
        CANCELED
    }

    private State currentState;

    // Attributes
    private UUID rental_id;
    private UUID customer_id;
    private UUID console_id;
    private LocalDateTime start_time;
    private LocalDateTime end_time;
    private String status;

    // Constructor
    public Rental() {
        super();
        ObjectBroker.getInstance().add(this);
        this.currentState = State.PENDING;
    }

    // Getters and Setters
    public UUID getRental_id() {
        return this.rental_id;
    }

    public void setRental_id(UUID rental_id) {
        this.rental_id = rental_id;
    }

    public UUID getCustomer_id() {
        return this.customer_id;
    }

    public void setCustomer_id(UUID customer_id) {
        this.customer_id = customer_id;
    }

    public UUID getConsole_id() {
        return this.console_id;
    }

    public void setConsole_id(UUID console_id) {
        this.console_id = console_id;
    }

    public LocalDateTime getStart_time() {
        return this.start_time;
    }

    public void setStart_time(LocalDateTime start_time) {
        this.start_time = start_time;
    }

    public LocalDateTime getEnd_time() {
        return this.end_time;
    }

    public void setEnd_time(LocalDateTime end_time) {
        this.end_time = end_time;
    }

    public String getStatus() {
        return this.status;
    }

    public void setStatus(String status) {
        this.status = status;
    }

    // State Machine Processing Loop
    @Override
    public void processEvent(XtUmlEvent e) {
        switch (currentState) {
            case PENDING:
                if (e.getEventId() == EVENT_END_TIME_PASSED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                else if (e.getEventId() == EVENT_SETCANCELED) {
                    action_CANCELED(e);
                    this.currentState = State.CANCELED;
                }
                else if (e.getEventId() == EVENT_PAY_CONFIRMED) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_SETEXPIRED) {
                    action_EXPIRED(e);
                    this.currentState = State.EXPIRED;
                }
                else if (e.getEventId() == EVENT_SETCOMPLETED) {
                    action_COMPLETED(e);
                    this.currentState = State.COMPLETED;
                }
                else if (e.getEventId() == EVENT_CANCEL_REQUEST) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_UNIT_RETURNED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                break;
            case RENTED:
                if (e.getEventId() == EVENT_END_TIME_PASSED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                else if (e.getEventId() == EVENT_SETCANCELED) {
                    action_CANCELED(e);
                    this.currentState = State.CANCELED;
                }
                else if (e.getEventId() == EVENT_PAY_CONFIRMED) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_SETEXPIRED) {
                    action_EXPIRED(e);
                    this.currentState = State.EXPIRED;
                }
                else if (e.getEventId() == EVENT_SETCOMPLETED) {
                    action_COMPLETED(e);
                    this.currentState = State.COMPLETED;
                }
                else if (e.getEventId() == EVENT_CANCEL_REQUEST) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_UNIT_RETURNED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                break;
            case EXPIRED:
                if (e.getEventId() == EVENT_END_TIME_PASSED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                else if (e.getEventId() == EVENT_SETCANCELED) {
                    action_CANCELED(e);
                    this.currentState = State.CANCELED;
                }
                else if (e.getEventId() == EVENT_PAY_CONFIRMED) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_SETEXPIRED) {
                    action_EXPIRED(e);
                    this.currentState = State.EXPIRED;
                }
                else if (e.getEventId() == EVENT_SETCOMPLETED) {
                    action_COMPLETED(e);
                    this.currentState = State.COMPLETED;
                }
                else if (e.getEventId() == EVENT_CANCEL_REQUEST) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_UNIT_RETURNED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                break;
            case COMPLETED:
                if (e.getEventId() == EVENT_END_TIME_PASSED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                else if (e.getEventId() == EVENT_SETCANCELED) {
                    action_CANCELED(e);
                    this.currentState = State.CANCELED;
                }
                else if (e.getEventId() == EVENT_PAY_CONFIRMED) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_SETEXPIRED) {
                    action_EXPIRED(e);
                    this.currentState = State.EXPIRED;
                }
                else if (e.getEventId() == EVENT_SETCOMPLETED) {
                    action_COMPLETED(e);
                    this.currentState = State.COMPLETED;
                }
                else if (e.getEventId() == EVENT_CANCEL_REQUEST) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_UNIT_RETURNED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                break;
            case CANCELED:
                if (e.getEventId() == EVENT_END_TIME_PASSED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                else if (e.getEventId() == EVENT_SETCANCELED) {
                    action_CANCELED(e);
                    this.currentState = State.CANCELED;
                }
                else if (e.getEventId() == EVENT_PAY_CONFIRMED) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_SETEXPIRED) {
                    action_EXPIRED(e);
                    this.currentState = State.EXPIRED;
                }
                else if (e.getEventId() == EVENT_SETCOMPLETED) {
                    action_COMPLETED(e);
                    this.currentState = State.COMPLETED;
                }
                else if (e.getEventId() == EVENT_CANCEL_REQUEST) {
                    action_PENDING(e);
                    this.currentState = State.PENDING;
                }
                else if (e.getEventId() == EVENT_UNIT_RETURNED) {
                    action_RENTED(e);
                    this.currentState = State.RENTED;
                }
                break;
        }
    }

    private void action_PENDING(XtUmlEvent rcvd_evt) {
        System.out.println("Entering state: PENDING");
        System.out.println("Rental request pending payment.");
    }

    private void action_RENTED(XtUmlEvent rcvd_evt) {
        System.out.println("Entering state: RENTED");
        java.time.LocalDateTime now = java.time.LocalDateTime.now();
        System.out.println("Unit rented successfully.");
        PSConsole console = ObjectBroker.getInstance().selectAll(PSConsole.class).stream()
    .filter(candidate -> "available".equals(candidate.getAvailability()))
    .findFirst().orElse(null);
        RelationshipManager.getInstance().relate(this, console, "R2", null);
    }

    private void action_EXPIRED(XtUmlEvent rcvd_evt) {
        System.out.println("Entering state: EXPIRED");
        System.out.println("Rental expired.");
        PSConsole console = (PSConsole) RelationshipManager.getInstance().getRelated(this, "R2", null).stream()
    .findFirst().orElse(null);
        RelationshipManager.getInstance().unrelate(this, console, "R2", null);
    }

    private void action_COMPLETED(XtUmlEvent rcvd_evt) {
        System.out.println("Entering state: COMPLETED");
        System.out.println("Rental completed.");
        if (this.getEnd_time() == null) {
        System.out.println("Early return suspected");
        }
    }

    private void action_CANCELED(XtUmlEvent rcvd_evt) {
        System.out.println("Entering state: CANCELED");
        System.out.println("Rental canceled.");
        this.delete();
    }

    // Logical Deletion
    @Override
    public void delete() {
        ObjectBroker.getInstance().remove(this);
        super.delete();
    }
}
